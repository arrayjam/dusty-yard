<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
  stroke-linejoin: round;
  fill: none;
}

.topojson {
  stroke: #222;
}

.voronoi {
  stroke: blue;
}

.geojson {
  stroke: red;
  stroke-width: 2;
}

</style>
<body>
<script src="vendor/d3/d3.js"></script>
<script src="vendor/queue-async/queue.js"></script>
<script src="vendor/topojson/topojson.js"></script>
<script>
var width = 960,
  height = 600;

var ausCenter = [144.9, -37.8];
var parallels = [-36, -18];

var projection = d3.geo.albers()
    .translate([width / 2, height / 2])
    .scale(171600)
    .rotate([-ausCenter[0], 0])
    .center([0, ausCenter[1]])
    .parallels(parallels)
    .precision(0);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var zoom = d3.behavior.zoom()
    .translate(projection.translate())
    .scale(projection.scale())
    .on("zoom", zoomed);

svg.call(zoom);

d3.json("data/voronoi.json", function(err, geo) {
  window.geo = geo;
  console.log(geo);
  svg.selectAll("path.geojson")
      .data(geo.features)
      .enter().append("path")
      .attr("class", "geojson")
      .attr("d", path);


  d3.json("data/result.json", function(err, json) {
    var booths = d3.values(json).map(function(booth) {
      return booth.position;
    });


  svg.selectAll("path.voronoi")
      .data(d3.geom.voronoi(booths.map(projection)))
      .enter().append("path")
      .attr("class", "voronoi")
      .attr("d", function(d) { var path = "M" + d.join("L") + "Z"; return path;});



  });
});

function zoomed() {
  projection
    .translate(d3.event.translate)
    .scale(d3.event.scale);

  svg.selectAll("path").attr("d", path);
}
</script>

