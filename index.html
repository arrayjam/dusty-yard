<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
  stroke-linejoin: round;
  fill: none;
}

.topojson {
  stroke: #222;
}

.voronoi {
  stroke: none;
}

.geojson {
  stroke: red;
}

.ocean {
  fill: steelblue;
}

</style>
<body>
<script src="vendor/d3/d3.js"></script>
<script src="vendor/queue-async/queue.js"></script>
<script src="vendor/topojson/topojson.js"></script>
<script>
var width = 960,
  height = 600;

var ausCenter = [144.9, -37.8];
var parallels = [-36, -18];

var projection = d3.geo.albers()
    .translate([width / 2, height / 2])
    .scale(171600)
    .rotate([-ausCenter[0], 0])
    .center([0, ausCenter[1]])
    .parallels(parallels)
    .clipExtent([[0, 0], [width, height]])
    .precision(0);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var zoom = d3.behavior.zoom()
    .translate(projection.translate())
    .scale(projection.scale())
    .on("zoom", zoomed);

svg.call(zoom);


queue()
  .defer(d3.json, "data/voronoi.topo.json")
  .defer(d3.json, "data/ocean.json")
  .defer(d3.json, "data/result.json")
  .await(ready);

var booths;
function ready(err, geo, ocean, result) {

  window.geo = geo;
  console.log(geo);
  svg.selectAll("path.geojson")
      .data(topojson.feature(geo, geo.objects.voronoi).features)
    .enter().append("path")
      .attr("class", "geojson")
      .attr("d", path);

  svg.append("path")
      .datum(topojson.feature(ocean, ocean.objects.ocean))
      .attr("class", "ocean")
      .attr("d", path);

  booths = d3.values(result).map(function(d) { return d.position; });
  svg.selectAll("circle.booth")
      .data(booths.map(projection))
    .enter().append("circle")
      .attr("class", "booth")
      .attr("cx", function(d) { return d[0]; })
      .attr("cy", function(d) { return d[1]; })
      .attr("r", 1.5);


  console.log(ocean);
}

function zoomed() {
  projection
    .translate(d3.event.translate)
    .scale(d3.event.scale);

  svg.selectAll("path").attr("d", path);
  svg.selectAll("circle.booth")
    .data(booths.map(projection))
    .attr("cx", function(d) { return d[0]; })
    .attr("cy", function(d) { return d[1]; });
}
</script>

